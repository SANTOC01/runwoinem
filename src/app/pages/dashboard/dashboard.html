<div class="dashboard-banner">
  <img src="/assets/banner/banner.jpg" alt="Banner" class="banner-img"/>
</div>

<div class="welcome-banner">
  <h1>Lauftreff Runwoinem</h1>
</div>

<div class="dashboard">

  <div class="content-wrapper">

    <div class="info-widget">
      <h2>
        â„¹ï¸ Infos
      </h2>
      <p>
        Unser Lauftreff findet jeden Dienstag um 18 Uhr am FahrradstÃ¤nder
        am Waidsee statt. Gemeinsam laufen wir etwa eine Stunde,
        um Freude an der Bewegung zu haben,
        fit zu bleiben und den Sport in geselliger Runde zu genieÃŸen.
        Die StreckenlÃ¤nge und das Tempo passen wir dabei flexibel an die
        BedÃ¼rfnisse und Vorlieben aller Teilnehmer an, damit jeder in seinem
        eigenen Tempo mitlaufen kann.
      </p> <br>

      <h2>Social Media</h2>
      <a href="https://www.strava.com/clubs/runwoinem" target="_blank" rel="noopener"
         class="social-icon-link" title="Strava">
        <img src="/assets/banner/strava.png" alt="Strava" class="social-icon"/>
      </a>
      <a href="https://www.instagram.com/runwoinem/" target="_blank" rel="noopener"
         class="social-icon-link" title="Instagram">
        <img src="/assets/banner/instagram.png" alt="Instagram" class="social-icon"/>
      </a>
      <a href="https://chat.whatsapp.com/ERi10lC4L8d9vwRW2m2Js1" target="_blank" rel="noopener"
         class="social-icon-link" title="WhatsApp">
        <img src="/assets/banner/whatsapp.png" alt="WhatsApp" class="social-icon"/>
      </a>
    </div>

    <div class="map-popup" [class.open]="mapOpen" (click)="toggleMap()">
      <img src="/assets/map.png" alt="Treffpunkt am Waidsee - Karte"/>
      <div class="map-caption">
        <span>ğŸ“ Treffpunkt am Waidsee</span>
        @if (!mapOpen) {
          <span class="expand-hint">Karte anzeigen â–¼</span>
        }
      </div>
      @if (mapOpen) {
        <div class="close-map-overlay"></div>
      }
    </div>

    @if (!showWidget) {
      <div class="dashboard-loading-container">
        <app-loading [isLoading]="true" [useOverlay]="false"></app-loading>
      </div>
    }

    @if (showWidget) {
      <div class="widgets-container">

        <div class="events-widget-container">
          <app-events
            (openEventModal)="openEventModal($event)">
          </app-events>
          <div class="events-scroll-guard"></div>
        </div>

        <div class="challenge-column">

          <div class="eurotrip-widget"
               [style.backgroundImage]="isKmChallengeOpen && eurotripBgImage ? 'url(' + eurotripBgImage + ')' : 'none'"
               [class.construction-mode]="!isKmChallengeOpen"
               role="region" aria-label="Eurotrip Challenge Widget">

            @if (isKmChallengeOpen) {
              <div class="widget-content">
                <h2 class="widget-title">ğŸ—ºï¸ Eurotrip Challenge</h2>
                <div class="widget-data">
                  <app-europe-map
                    [total]="(kmChallengeService.total$ | async) || 0"
                    (bgImagePath)="eurotripBgImage = $event">
                  </app-europe-map>
                </div>
                <a routerLink="/km-challenge"
                   class="challenge-btn"
                   aria-label="Navigiere zur Eurotrip Challenge Detailseite">
                  ğŸš€ Eurotrip Challenge
                </a>
              </div>
            } @else {
              <div class="widget-content construction-content">
                <h2 class="widget-title">Schnapp dir deine GummibÃ¤rchen</h2>
                <div class="construction-body">
                  <div class="construction-icon">ğŸ—ºï¸</div>
                  <p class="construction-text">Wir brauchen etwas mehr Zeit als geplant â€“ aber keine Sorge, es wird â€Moderat". ğŸ˜<br>ğŸƒâ€â™‚ï¸ğŸŒâœ¨</p>
                  <p class="construction-text"><br>Startet am <strong>3. MÃ¤rz 2026 um 18:10 Uhr</strong></p>
                  <div class="countdown-grid">
                    <div class="countdown-block">
                      <span class="countdown-num">{{ countdown.days }}</span>
                      <span class="countdown-label">Tage</span>
                    </div>
                    <div class="countdown-sep">:</div>
                    <div class="countdown-block">
                      <span class="countdown-num">{{ countdown.hours | number:'2.0-0' }}</span>
                      <span class="countdown-label">Std</span>
                    </div>
                    <div class="countdown-sep">:</div>
                    <div class="countdown-block">
                      <span class="countdown-num">{{ countdown.minutes | number:'2.0-0' }}</span>
                      <span class="countdown-label">Min</span>
                    </div>
                    <div class="countdown-sep">:</div>
                    <div class="countdown-block">
                      <span class="countdown-num">{{ countdown.seconds | number:'2.0-0' }}</span>
                      <span class="countdown-label">Sek</span>
                    </div>
                  </div>
                </div>
              </div>
            }

          </div>

          <div class="challenge-widget-mini" role="region" aria-label="GipfelstÃ¼rmer Challenge (beendet)">
            <div class="widget-content-mini">
              <h3>ğŸ”ï¸ GipfelstÃ¼rmer Challenge</h3>
              <p class="challenge-ended-text">ğŸ”’ Challenge beendet â€“ danke fÃ¼r eure Teilnahme!</p>
              <a routerLink="/challenge"
                 class="challenge-btn-mini"
                 aria-label="GipfelstÃ¼rmer Challenge Detailseite">
                ğŸ¯ GipfelstÃ¼rmer Challenge
              </a>
            </div>
          </div>

        </div>

      </div>
    }
  </div>
</div>

<app-events-modal
  [event]="selectedEvent"
  [show]="!!selectedEvent"
  (close)="closeEventModal()">
</app-events-modal>

<app-training-popup />

