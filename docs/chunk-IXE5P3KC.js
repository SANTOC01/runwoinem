import{a as I,b as K}from"./chunk-FZ4TROQV.js";import{a as V,b as B,c as j,d as F,e as R}from"./chunk-TIW6RMT2.js";import{$a as _,Ca as v,Lb as x,Nb as E,Qa as b,Ra as k,Va as c,W as u,Wa as a,X as C,Xa as r,Ya as p,Za as P,_a as s,c as d,db as f,dc as D,ec as T,fb as h,gb as S,hb as M,ib as O,pb as y,qb as w,sa as i,wa as m}from"./chunk-3GUTXQ2T.js";function L(g,n){if(g&1){let t=P();a(0,"app-lock-screen",14),s("success",function(){u(t);let o=_();return C(o.lockService.handleUnlockSuccess())})("cancel",function(){u(t);let o=_();return C(o.lockService.handleUnlockCancel())}),r()}}var U=class g{constructor(n,t,e){this.kmChallengeService=n;this.lockService=t;this.toast=e}entries=[];rankings=[];total=0;progressPercentage=0;cityBgPath="";subscriptions=[];ngOnInit(){this.kmChallengeService.loadData(),this.subscriptions.push(this.kmChallengeService.entries$.subscribe(n=>{this.entries=[...n].sort((t,e)=>new Date(e.date).getTime()-new Date(t.date).getTime())}),this.kmChallengeService.rankings$.subscribe(n=>{this.rankings=n}),this.kmChallengeService.total$.subscribe(n=>{this.total=n,this.progressPercentage=Math.min(Math.round(n/this.kmChallengeService.config.goalValue*100),100)}))}ngOnDestroy(){this.subscriptions.forEach(n=>n.unsubscribe())}onValueChange(n){let{name:t,value:e}=n;e>this.kmChallengeService.config.maxEntryValue?this.toast.show("Sei ehrlich \u{1F925}\u{1F60F}\u{1F633}"):e>30?this.toast.show("Boaah \u{1F628}"):e>10&&this.toast.show(`Stark ${t.split(" ")[0]} \u{1F4AA}`)}onSubmit(n){return d(this,null,function*(){try{yield this.kmChallengeService.submitData(n.name,n.value)}catch(t){console.error("Error submitting data:",t)}})}onDelete(n){return d(this,null,function*(){try{yield this.kmChallengeService.deleteData(n)}catch(t){console.error("Error deleting entry:",t)}})}static \u0275fac=function(t){return new(t||g)(m(K),m(D),m(T))};static \u0275cmp=v({type:g,selectors:[["app-km-challenge"]],decls:21,vars:20,consts:[[1,"challenge-container"],[1,"content-wrapper"],[1,"header"],[3,"total","goals","unit"],[3,"submitted","valueChanged","config"],[1,"data-section"],[3,"deleteRequested","entries","unit"],[3,"rankings","unit"],[1,"progress-section"],[1,"progress-header"],[1,"progress-bar"],[1,"progress"],[1,"progress-label"],[3,"bgImagePath","total"],[3,"success","cancel"]],template:function(t,e){t&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),h(4),r(),p(5,"app-goal-banner",3),r(),a(6,"app-challenge-form",4),s("submitted",function(l){return e.onSubmit(l)})("valueChanged",function(l){return e.onValueChange(l)}),r(),a(7,"div",5)(8,"app-stats-table",6),s("deleteRequested",function(l){return e.onDelete(l)}),r(),p(9,"app-ranking-table",7),r(),a(10,"div",8)(11,"div",9)(12,"h2"),h(13),r(),a(14,"div",10),p(15,"div",11),a(16,"span",12),h(17),r()()(),a(18,"app-europe-map",13),s("bgImagePath",function(l){return e.cityBgPath=l}),r()()(),b(19,L,1,0,"app-lock-screen"),y(20,"async"),r()),t&2&&(f("background-image",e.cityBgPath?"url("+e.cityBgPath+")":"url(assets/mountain.jpg)"),i(4),S(e.kmChallengeService.config.title),i(),c("total",e.total)("goals",e.kmChallengeService.config.goals)("unit",e.kmChallengeService.config.metricUnit),i(),c("config",e.kmChallengeService.config),i(2),c("entries",e.entries)("unit",e.kmChallengeService.config.metricUnit),i(),c("rankings",e.rankings)("unit",e.kmChallengeService.config.metricUnit),i(4),O("\u{1F5FA}\uFE0F Fortschritt Gesamt: ",e.total," ",e.kmChallengeService.config.metricUnit),i(2),f("width",e.progressPercentage,"%"),i(2),M("",e.progressPercentage,"%"),i(),c("total",e.total),i(),k(w(20,18,e.lockService.showLockScreen$)?19:-1))},dependencies:[E,x,V,B,I,j,F,R],styles:[".challenge-container[_ngcontent-%COMP%]{min-height:100vh;width:100%;background-size:cover;background-position:top;background-repeat:no-repeat;overflow-y:auto;padding-top:80px}.challenge-container[_ngcontent-%COMP%]   .content-wrapper[_ngcontent-%COMP%]{min-height:calc(100vh - 80px);max-width:1200px;margin:0 auto;padding:2rem;position:relative;z-index:1}.challenge-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{text-align:center;margin-bottom:2rem}.challenge-container[_ngcontent-%COMP%]   .data-section[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:2rem;margin-bottom:2rem;padding:1rem;max-width:900px;margin-left:auto;margin-right:auto;background:#ffffffe6;border-radius:15px;box-shadow:0 4px 6px #0000001a}.challenge-container[_ngcontent-%COMP%]   .data-section[_ngcontent-%COMP%]   app-stats-table[_ngcontent-%COMP%], .challenge-container[_ngcontent-%COMP%]   .data-section[_ngcontent-%COMP%]   app-ranking-table[_ngcontent-%COMP%]{flex:1;min-width:0}.challenge-container[_ngcontent-%COMP%]   .progress-section[_ngcontent-%COMP%]{max-width:900px;margin-left:auto;margin-right:auto;margin-bottom:2rem;padding:1.5rem;background:#fff;border-radius:15px;box-shadow:0 4px 6px #0000001a}.challenge-container[_ngcontent-%COMP%]   .progress-section[_ngcontent-%COMP%]   .progress-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:1.5rem}.challenge-container[_ngcontent-%COMP%]   .progress-section[_ngcontent-%COMP%]   .progress-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#2c3e50;margin-bottom:1rem}.challenge-container[_ngcontent-%COMP%]   .progress-section[_ngcontent-%COMP%]   .progress-bar[_ngcontent-%COMP%]{width:100%;height:24px;background:#e0e0e0;border-radius:12px;overflow:hidden;position:relative}.challenge-container[_ngcontent-%COMP%]   .progress-section[_ngcontent-%COMP%]   .progress-bar[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]{height:100%;background:#43c6ac;transition:width .3s ease;border-radius:12px}.challenge-container[_ngcontent-%COMP%]   .progress-section[_ngcontent-%COMP%]   .progress-bar[_ngcontent-%COMP%]   .progress-label[_ngcontent-%COMP%]{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:.78rem;font-weight:700;color:#fff;text-shadow:0 0 4px rgba(0,0,0,.55);pointer-events:none}@media (max-width: 768px){.challenge-container[_ngcontent-%COMP%]   .content-wrapper[_ngcontent-%COMP%]{padding-left:1rem;padding-right:1rem}.challenge-container[_ngcontent-%COMP%]   .data-section[_ngcontent-%COMP%]{flex-direction:column}}"]})};export{U as KmChallenge};
